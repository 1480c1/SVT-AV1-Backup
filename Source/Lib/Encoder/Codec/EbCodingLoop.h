/*
* Copyright(c) 2019 Intel Corporation
* SPDX - License - Identifier: BSD - 2 - Clause - Patent
*/

#ifndef EbCodingLoop_h
#define EbCodingLoop_h

#include "EbCodingUnit.h"
#include "EbSequenceControlSet.h"
#include "EbModeDecisionProcess.h"
#include "EbEncDecProcess.h"

#ifdef __cplusplus
extern "C" {
#endif
/*******************************************
     * ModeDecisionSb
     *   performs CL (SB)
     *******************************************/
extern EbErrorType mode_decision_sb(SequenceControlSet *scs_ptr, PictureControlSet *pcs_ptr,
                                    const MdcSbData *const mdcResultTbPtr, SuperBlock *sb_ptr,
                                    uint16_t sb_origin_x, uint16_t sb_origin_y, uint32_t sb_addr,
                                    ModeDecisionContext *context_ptr);

uint8_t get_skip_tx_search_flag(int32_t sq_size, uint64_t ref_fast_cost, uint64_t cu_cost,
                                uint64_t weight);

extern void av1_encode_pass(SequenceControlSet *scs_ptr, PictureControlSet *pcs_ptr,
    SuperBlock *sb_ptr, uint32_t sb_addr, uint32_t sb_origin_x,
    uint32_t sb_origin_y, EncDecContext *context_ptr);
#if NO_ENCDEC
void no_enc_dec_pass(SequenceControlSet *scs_ptr, PictureControlSet *pcs_ptr, SuperBlock *sb_ptr,
                     uint32_t sb_addr, uint32_t sb_origin_x, uint32_t sb_origin_y, uint32_t sb_qp,
                     EncDecContext *context_ptr);
#endif

void store16bit_input_src(EbPictureBufferDesc *input_sample16bit_buffer, PictureControlSet *pcs_ptr,
                          uint32_t sb_x, uint32_t sb_y, uint32_t sb_w, uint32_t sb_h);

void residual_kernel(uint8_t *input, uint32_t input_offset, uint32_t input_stride, uint8_t *pred,
                     uint32_t pred_offset, uint32_t pred_stride, int16_t *residual,
                     uint32_t residual_offset, uint32_t residual_stride, EbBool hbd,
                     uint32_t area_width, uint32_t area_height);
#if COEFF_BASED_BYPASS_NSQ
#if IMPROVED_NSQ_CYCLES_REDUCTION
#if M1_PROB
static const uint64_t block_prob_tab_m1[5][9][3][2] = {
{
{{ 389 , 0 },{ 6 , 0 },{ 1 , 0 }},
{{ 1 , 40 },{ 0 , 2 },{ 0 , 0 }},
{{ 1 , 32 },{ 0 , 1 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 3 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
},
{
{{ 370 , 40 },{ 12 , 0 },{ 0 , 0 }},
{{ 4 , 32 },{ 0 , 1 },{ 0 , 0 }},
{{ 8 , 51 },{ 1 , 4 },{ 0 , 0 }},
{{ 0 , 3 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 3 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 3 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 3 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 27 },{ 0 , 2 },{ 0 , 1 }},
{{ 1 , 58 },{ 0 , 6 },{ 0 , 0 }}
},
{
{{ 310 , 99 },{ 11 , 2 },{ 2 , 0 }},
{{ 5 , 44 },{ 1 , 9 },{ 0 , 1 }},
{{ 5 , 49 },{ 1 , 7 },{ 0 , 1 }},
{{ 1 , 6 },{ 0 , 4 },{ 0 , 1 }},
{{ 1 , 6 },{ 1 , 4 },{ 0 , 1 }},
{{ 1 , 7 },{ 0 , 4 },{ 0 , 1 }},
{{ 1 , 8 },{ 1 , 4 },{ 0 , 1 }},
{{ 0 , 23 },{ 0 , 14 },{ 0 , 2 }},
{{ 0 , 40 },{ 0 , 13 },{ 0 , 2 }}
},
{
{{ 224 , 65 },{ 41 , 9 },{ 9 , 2 }},
{{ 3 , 34 },{ 4 , 41 },{ 1 , 7 }},
{{ 3 , 42 },{ 4 , 43 },{ 1 , 8 }},
{{ 0 , 4 },{ 1 , 17 },{ 0 , 4 }},
{{ 0 , 4 },{ 2 , 17 },{ 1 , 6 }},
{{ 0 , 5 },{ 1 , 20 },{ 0 , 4 }},
{{ 0 , 4 },{ 2 , 19 },{ 1 , 6 }},
{{ 0 , 3 },{ 0 , 20 },{ 0 , 3 }},
{{ 0 , 5 },{ 0 , 24 },{ 0 , 4 }}
},
{
{{ 31 , 8 },{ 34 , 9 },{ 12 , 3 }},
{{ 0 , 2 },{ 1 , 19 },{ 0 , 7 }},
{{ 0 , 3 },{ 1 , 22 },{ 0 , 8 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
}
};
#endif
#if M3_PROB
static const uint64_t block_prob_tab_m3[5][9][3][2] = {
{
{{ 394 , 0 },{ 6 , 0 },{ 1 , 0 }},
{{ 1 , 59 },{ 0 , 3 },{ 0 , 1 }},
{{ 2 , 51 },{ 0 , 2 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
},
{
{{ 360 , 20 },{ 13 , 0 },{ 0 , 0 }},
{{ 5 , 37 },{ 0 , 1 },{ 0 , 0 }},
{{ 9 , 55 },{ 1 , 4 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 25 },{ 0 , 2 },{ 0 , 2 }},
{{ 0 , 49 },{ 0 , 6 },{ 0 , 0 }}
},
{
{{ 282 , 88 },{ 16 , 3 },{ 3 , 1 }},
{{ 6 , 49 },{ 1 , 13 },{ 0 , 2 }},
{{ 6 , 53 },{ 1 , 11 },{ 0 , 2 }},
{{ 0 , 4 },{ 0 , 3 },{ 0 , 0 }},
{{ 0 , 4 },{ 1 , 3 },{ 0 , 1 }},
{{ 0 , 5 },{ 0 , 3 },{ 0 , 1 }},
{{ 1 , 5 },{ 0 , 3 },{ 0 , 1 }},
{{ 0 , 20 },{ 0 , 18 },{ 0 , 3 }},
{{ 0 , 34 },{ 0 , 16 },{ 0 , 3 }}
},
{
{{ 201 , 49 },{ 43 , 6 },{ 9 , 1 }},
{{ 3 , 34 },{ 4 , 45 },{ 1 , 10 }},
{{ 4 , 41 },{ 5 , 49 },{ 1 , 10 }},
{{ 0 , 2 },{ 1 , 9 },{ 0 , 2 }},
{{ 0 , 2 },{ 1 , 10 },{ 0 , 3 }},
{{ 0 , 2 },{ 1 , 12 },{ 0 , 3 }},
{{ 0 , 2 },{ 1 , 11 },{ 1 , 4 }},
{{ 0 , 2 },{ 0 , 16 },{ 0 , 3 }},
{{ 0 , 4 },{ 0 , 21 },{ 0 , 4 }}
},
{
{{ 35 , 6 },{ 36 , 5 },{ 13 , 1 }},
{{ 0 , 2 },{ 1 , 18 },{ 0 , 7 }},
{{ 0 , 3 },{ 1 , 21 },{ 0 , 8 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
}
};
#endif
#if M5_PROB
static const uint64_t block_prob_tab_m5[5][9][3][2] = {
{
{{ 379 , 0 },{ 6 , 0 },{ 1 , 0 }},
{{ 2 , 57 },{ 0 , 3 },{ 0 , 1 }},
{{ 2 , 49 },{ 0 , 2 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
},
{
{{ 350 , 20 },{ 14 , 0 },{ 0 , 0 }},
{{ 4 , 37 },{ 0 , 1 },{ 0 , 1 }},
{{ 10 , 57 },{ 1 , 5 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 25 },{ 0 , 2 },{ 0 , 2 }},
{{ 1 , 49 },{ 0 , 7 },{ 0 , 0 }}
},
{
{{ 268 , 86 },{ 16 , 4 },{ 3 , 1 }},
{{ 5 , 46 },{ 1 , 12 },{ 0 , 2 }},
{{ 6 , 49 },{ 1 , 10 },{ 0 , 2 }},
{{ 0 , 4 },{ 0 , 3 },{ 0 , 1 }},
{{ 0 , 4 },{ 1 , 3 },{ 0 , 1 }},
{{ 0 , 5 },{ 0 , 3 },{ 0 , 0 }},
{{ 1 , 5 },{ 0 , 3 },{ 0 , 1 }},
{{ 0 , 20 },{ 0 , 17 },{ 0 , 3 }},
{{ 0 , 34 },{ 0 , 16 },{ 0 , 3 }}
},
{
{{ 195 , 49 },{ 39 , 6 },{ 9 , 1 }},
{{ 3 , 32 },{ 4 , 41 },{ 1 , 10 }},
{{ 4 , 38 },{ 4 , 45 },{ 1 , 11 }},
{{ 0 , 2 },{ 1 , 10 },{ 0 , 2 }},
{{ 0 , 2 },{ 1 , 10 },{ 0 , 3 }},
{{ 0 , 2 },{ 1 , 13 },{ 0 , 3 }},
{{ 0 , 2 },{ 1 , 12 },{ 1 , 4 }},
{{ 0 , 3 },{ 0 , 16 },{ 0 , 5 }},
{{ 0 , 5 },{ 0 , 23 },{ 0 , 6 }}
},
{
{{ 34 , 7 },{ 29 , 5 },{ 12 , 2 }},
{{ 0 , 2 },{ 1 , 21 },{ 0 , 11 }},
{{ 0 , 3 },{ 1 , 25 },{ 0 , 12 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
}
};
#endif
#if M6_PROB
static const uint64_t block_prob_tab_m6[5][9][3][2] = {
{
{{ 373 , 0 },{ 6 , 0 },{ 1 , 0 }},
{{ 2 , 57 },{ 0 , 3 },{ 0 , 1 }},
{{ 2 , 49 },{ 0 , 2 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
},
{
{{ 339 , 18 },{ 13 , 0 },{ 0 , 0 }},
{{ 5 , 36 },{ 0 , 1 },{ 0 , 0 }},
{{ 10 , 56 },{ 1 , 4 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 25 },{ 0 , 3 },{ 0 , 2 }},
{{ 0 , 48 },{ 0 , 7 },{ 0 , 0 }}
},
{
{{ 259 , 85 },{ 16 , 4 },{ 3 , 1 }},
{{ 5 , 44 },{ 1 , 12 },{ 0 , 2 }},
{{ 5 , 46 },{ 1 , 10 },{ 0 , 2 }},
{{ 0 , 4 },{ 0 , 3 },{ 0 , 1 }},
{{ 1 , 4 },{ 1 , 3 },{ 0 , 1 }},
{{ 0 , 5 },{ 0 , 4 },{ 0 , 1 }},
{{ 1 , 5 },{ 0 , 3 },{ 0 , 1 }},
{{ 0 , 20 },{ 0 , 17 },{ 0 , 3 }},
{{ 0 , 34 },{ 0 , 15 },{ 0 , 3 }}
},
{
{{ 188 , 48 },{ 37 , 6 },{ 9 , 1 }},
{{ 3 , 32 },{ 4 , 41 },{ 1 , 10 }},
{{ 4 , 38 },{ 4 , 44 },{ 1 , 11 }},
{{ 0 , 2 },{ 1 , 10 },{ 0 , 3 }},
{{ 0 , 2 },{ 1 , 9 },{ 0 , 3 }},
{{ 0 , 3 },{ 1 , 12 },{ 0 , 3 }},
{{ 0 , 2 },{ 1 , 11 },{ 1 , 4 }},
{{ 0 , 3 },{ 0 , 17 },{ 0 , 5 }},
{{ 0 , 6 },{ 0 , 25 },{ 0 , 6 }}
},
{
{{ 33 , 6 },{ 27 , 5 },{ 11 , 1 }},
{{ 0 , 3 },{ 1 , 21 },{ 0 , 11 }},
{{ 0 , 3 },{ 1 , 26 },{ 1 , 13 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
}
};
#endif
#if M7_PROB
static const uint64_t block_prob_tab_m7[5][9][3][2] = {
{
{{ 896 , 0 },{ 18 , 0 },{ 0 , 0 }},
{{ 6 , 46 },{ 0 , 1 },{ 0 , 0 }},
{{ 13 , 75 },{ 1 , 7 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 24 },{ 0 , 2 },{ 0 , 1 }},
{{ 1 , 54 },{ 0 , 8 },{ 0 , 0 }}
},
{
{{ 322 , 110 },{ 18 , 4 },{ 2 , 0 }},
{{ 6 , 52 },{ 2 , 14 },{ 0 , 2 }},
{{ 6 , 55 },{ 1 , 11 },{ 0 , 2 }},
{{ 0 , 4 },{ 0 , 3 },{ 0 , 0 }},
{{ 0 , 4 },{ 0 , 2 },{ 0 , 1 }},
{{ 0 , 5 },{ 0 , 3 },{ 0 , 0 }},
{{ 1 , 5 },{ 0 , 3 },{ 0 , 1 }},
{{ 0 , 20 },{ 0 , 14 },{ 0 , 2 }},
{{ 0 , 36 },{ 0 , 14 },{ 0 , 2 }}
},
{
{{ 234 , 57 },{ 56 , 9 },{ 11 , 1 }},
{{ 3 , 37 },{ 5 , 54 },{ 1 , 12 }},
{{ 4 , 44 },{ 5 , 55 },{ 1 , 12 }},
{{ 0 , 2 },{ 1 , 11 },{ 0 , 3 }},
{{ 0 , 2 },{ 1 , 11 },{ 0 , 4 }},
{{ 0 , 3 },{ 1 , 14 },{ 0 , 3 }},
{{ 0 , 3 },{ 1 , 12 },{ 1 , 4 }},
{{ 0 , 3 },{ 0 , 19 },{ 0 , 5 }},
{{ 0 , 6 },{ 0 , 27 },{ 0 , 6 }}
},
{
{{ 38 , 7 },{ 42 , 7 },{ 15 , 2 }},
{{ 0 , 3 },{ 1 , 28 },{ 1 , 14 }},
{{ 0 , 3 },{ 1 , 34 },{ 1 , 15 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
},
{
{{ 0 , 0 },{ 0 , 4 },{ 0 , 5 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
}
};
#endif
#if M8_PROB
static const uint64_t block_prob_tab_m8[5][9][3][2] = {
{
{{ 1156 , 0 },{ 4 , 0 },{ 0 , 0 }},
{{ 8 , 50 },{ 0 , 1 },{ 0 , 0 }},
{{ 13 , 67 },{ 0 , 1 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 1 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 29 },{ 0 , 1 },{ 0 , 0 }},
{{ 1 , 47 },{ 0 , 3 },{ 0 , 0 }}
},
{
{{ 701 , 1 },{ 34 , 1 },{ 7 , 0 }},
{{ 7 , 49 },{ 3 , 17 },{ 1 , 4 }},
{{ 7 , 51 },{ 2 , 13 },{ 1 , 5 }},
{{ 0 , 2 },{ 0 , 2 },{ 0 , 0 }},
{{ 0 , 2 },{ 1 , 2 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 1 },{ 0 , 0 }},
{{ 0 , 2 },{ 0 , 1 },{ 0 , 1 }},
{{ 0 , 17 },{ 0 , 16 },{ 0 , 2 }},
{{ 0 , 28 },{ 0 , 10 },{ 0 , 2 }}
},
{
{{ 643 , 2 },{ 71 , 1 },{ 12 , 0 }},
{{ 4 , 34 },{ 4 , 32 },{ 1 , 7 }},
{{ 6 , 51 },{ 6 , 45 },{ 2 , 11 }},
{{ 0 , 1 },{ 0 , 4 },{ 0 , 1 }},
{{ 0 , 1 },{ 1 , 4 },{ 0 , 1 }},
{{ 0 , 1 },{ 0 , 6 },{ 0 , 2 }},
{{ 0 , 1 },{ 1 , 5 },{ 0 , 2 }},
{{ 0 , 2 },{ 0 , 12 },{ 0 , 5 }},
{{ 0 , 7 },{ 0 , 18 },{ 0 , 6 }}
},
{
{{ 299 , 0 },{ 146 , 1 },{ 37 , 0 }},
{{ 1 , 10 },{ 3 , 60 },{ 1 , 26 }},
{{ 1 , 14 },{ 3 , 84 },{ 1 , 31 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
},
{
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
}
};
#endif
static const uint64_t block_prob_tab[5][9][3][2] = {
{
{{ 75 , 75 },{ 43 , 43 },{ 17 , 17 }},
{{ 8 , 9 },{ 29 , 29 },{ 17 , 17 }},
{{ 6 , 7 },{ 7 , 7 },{ 17 , 17 }},
{{ 2 , 2 },{ 5 , 6 },{ 0 , 0 }},
{{ 3 , 3 },{ 4 , 5 },{ 31 , 33 }},
{{ 1 , 1 },{ 2 , 2 },{ 0 , 0 }},
{{ 2 , 2 },{ 7 , 8 },{ 14 , 17 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
},
{
{{ 60 , 60 },{ 44 , 44 },{ 4 , 4 }},
{{ 5 , 5 },{ 1 , 1 },{ 3 , 3 }},
{{ 9 , 10 },{ 17 , 17 },{ 7 , 7 }},
{{ 2 , 2 },{ 2 , 2 },{ 5 , 5 }},
{{ 3 , 3 },{ 2 , 2 },{ 5 , 5 }},
{{ 2 , 2 },{ 1 , 1 },{ 4 , 5 }},
{{ 2 , 2 },{ 2 , 2 },{ 4 , 5 }},
{{ 4 , 5 },{ 5 , 6 },{ 41 , 51 }},
{{ 10 , 11 },{ 21 , 26 },{ 9 , 13 }}
},
{
{{ 59 , 59 },{ 14 , 14 },{ 19 , 19 }},
{{ 6 , 7 },{ 11 , 11 },{ 11 , 11 }},
{{ 7 , 8 },{ 7 , 7 },{ 8 , 8 }},
{{ 3 , 3 },{ 9 , 10 },{ 8 , 9 }},
{{ 3 , 3 },{ 11 , 11 },{ 11 , 11 }},
{{ 4 , 4 },{ 7 , 8 },{ 7 , 8 }},
{{ 4 , 4 },{ 8 , 9 },{ 11 , 12 }},
{{ 4 , 4 },{ 15 , 18 },{ 10 , 12 }},
{{ 6 , 7 },{ 11 , 13 },{ 8 , 10 }}
},
{
{{ 65 , 65 },{ 13 , 13 },{ 15 , 15 }},
{{ 8 , 10 },{ 16 , 17 },{ 15 , 16 }},
{{ 10 , 12 },{ 17 , 18 },{ 15 , 16 }},
{{ 3 , 3 },{ 8 , 9 },{ 8 , 9 }},
{{ 3 , 3 },{ 10 , 10 },{ 11 , 12 }},
{{ 3 , 3 },{ 10 , 11 },{ 9 , 10 }},
{{ 3 , 3 },{ 11 , 11 },{ 12 , 12 }},
{{ 1 , 1 },{ 5 , 5 },{ 5 , 5 }},
{{ 1 , 1 },{ 7 , 7 },{ 5 , 5 }}
},
{
{{ 87 , 87 },{ 54 , 54 },{ 59 , 59 }},
{{ 4 , 6 },{ 13 , 21 },{ 11 , 18 }},
{{ 6 , 7 },{ 21 , 26 },{ 18 , 22 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }},
{{ 0 , 0 },{ 0 , 0 },{ 0 , 0 }}
}
};
#else
#if MERGED_COEFF_BAND
#if SPEED_WEIGHT
static const uint64_t speed_weight[9] = {100,100,100,50,50,50,50,70,70};
static const uint64_t speed_weight2[9] = {100,100,100,60,60,60,60,80,80};
#endif
#if SSE_BASED_SPLITTING
static const uint64_t sse_grad_weight[5][9][3] = {
{
{ 0,0,0},
{ 12,0,0},
{ 9,1,2},
{ 11,13,6},
{ 10,13,7},
{ 11,14,12},
{ 11,16,16},
{ 11,16,19},
{ 13,27,38},
},
{
{ 0,0,0},
{ 10,5,0},
{ 8,1,5},
{ 10,8,7},
{ 10,9,10},
{ 11,12,14},
{ 11,14,17},
{ 12,17,19},
{ 12,19,27},
},
{
{ 0,0,0},
{ 11,0,0},
{ 10,3,3},
{ 11,6,7},
{ 11,3,4},
{ 11,10,11},
{ 10,9,9},
{ 10,16,18},
{ 9,16,18},
},
{
{ 0,0,0},
{ 22,8,7},
{ 16,6,6},
{ 10,10,11},
{ 8,5,5},
{ 6,5,7},
{ 4,0,1},
{ 3,5,6},
{ 2,4,5},
},
{
{ 0,0,0},
{ 39,38,38},
{ 20,20,20},
{ 0,0,0},
{ 0,0,0},
{ 0,0,0},
{ 0,0,0},
{ 0,0,0},
{ 0,0,0}
}
};
#endif
static const uint64_t allowed_part_weight[5][9][3] = {
{
{ 75,43,17},
{ 9,29,17},
{ 7,7,17},
{ 2,6,0},
{ 3,5,33},
{ 1,2,0},
{ 2,8,17},
{ 0,0,0},
{ 0,0,0}
},
{
{ 60,44,4},
{ 5,1,3},
{ 10,17,7},
{ 2,2,5},
{ 3,2,5},
{ 2,1,5},
{ 2,2,5},
{ 5,6,51},
{ 11,26,13}
},
{
{ 59,14,19},
{ 7,11,11},
{ 8,7,8},
{ 3,10,9},
{ 3,11,11},
{ 4,8,8},
{ 4,9,12},
{ 4,18,12},
{ 7,13,10}
},
{
{ 65,13,15},
{ 10,17,16},
{ 12,18,16},
{ 3,9,9},
{ 3,10,12},
{ 3,11,10},
{ 3,11,12},
{ 1,5,5},
{ 1,7,5}
},
{
{ 87,54,59},
{ 6,21,18},
{ 7,26,22},
{ 0,0,0},
{ 0,0,0},
{ 0,0,0},
{ 0,0,0},
{ 0,0,0},
{ 0,0,0}
}
};
#endif
static const uint64_t allowed_part_weight_1080p[5][9][10] = {
{
{ 80, 38, 0, 0, 0, 0, 0, 0, 0, 0},
{ 8, 13, 0, 0, 0, 0, 0, 0, 0, 0},
{ 6, 2, 0, 0, 0, 0, 0, 0, 0, 0},
{ 2, 10, 0, 0, 0, 0, 0, 0, 0, 0},
{ 2, 19, 0, 0, 0, 0, 0, 0, 0, 0},
{ 1, 4, 0, 0, 0, 0, 0, 0, 0, 0},
{ 2, 13, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
},
{
{ 58, 14, 22, 10, 5, 0, 0, 0, 0, 0},
{ 9, 13, 11, 10, 8, 0, 0, 0, 0, 0},
{ 9, 7, 7, 19, 27, 0, 0, 0, 0, 0},
{ 3, 7, 8, 5, 6, 0, 0, 0, 0, 0},
{ 3, 7, 9, 6, 7, 0, 0, 0, 0, 0},
{ 3, 4, 6, 12, 12, 0, 0, 0, 0, 0},
{ 3, 5, 7, 11, 15, 0, 0, 0, 0, 0},
{ 6, 26, 21, 22, 16, 0, 0, 0, 0, 0},
{ 7, 17, 9, 5, 3, 0, 0, 0, 0, 0}
},
{
{ 52, 16, 16, 19, 28, 31, 34, 25, 18, 13},
{ 9, 10, 11, 9, 8, 8, 7, 7, 7, 7},
{ 10, 8, 6, 7, 9, 6, 6, 6, 6, 6},
{ 5, 11, 11, 12, 10, 10, 9, 11, 10, 6},
{ 5, 11, 11, 12, 10, 10, 9, 10, 13, 17},
{ 5, 9, 9, 9, 8, 8, 8, 8, 9, 5},
{ 5, 10, 9, 9, 9, 7, 8, 9, 10, 15},
{ 4, 13, 16, 15, 12, 14, 13, 15, 16, 18},
{ 6, 12, 10, 8, 7, 5, 7, 8, 10, 13}
},
{
{ 63, 26, 22, 19, 17, 17, 15, 11, 8, 8},
{ 12, 18, 19, 17, 16, 16, 16, 17, 17, 15},
{ 12, 20, 15, 14, 13, 11, 10, 8, 7, 8},
{ 3, 8, 10, 11, 12, 12, 13, 16, 17, 15},
{ 2, 7, 9, 11, 12, 12, 14, 15, 18, 19},
{ 3, 8, 9, 10, 10, 10, 10, 10, 10, 10},
{ 3, 8, 9, 10, 10, 10, 11, 11, 11, 13},
{ 1, 3, 3, 4, 6, 7, 8, 9, 10, 9},
{ 1, 3, 3, 4, 4, 4, 3, 3, 2, 3}
},
{
{ 91, 73, 66, 63, 59, 62, 64, 67, 71, 71},
{ 5, 13, 16, 22, 19, 21, 21, 18, 17, 17},
{ 4, 13, 18, 15, 22, 17, 16, 14, 12, 12},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
}
};
static const uint64_t allowed_part_weight_720p[5][9][10] = {
{
{ 78, 30, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 6, 6, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 12, 55, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 1, 9, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
},
{
{ 54, 6, 10, 0, 1, 0, 0, 0, 0, 0 },
{ 9, 14, 13, 21, 13, 0, 0, 0, 0, 0 },
{ 9, 5, 5, 20, 25, 0, 0, 0, 0, 0 },
{ 3, 5, 7, 5, 2, 0, 0, 0, 0, 0 },
{ 3, 5, 8, 3, 4, 0, 0, 0, 0, 0 },
{ 3, 3, 4, 1, 1, 0, 0, 0, 0, 0 },
{ 3, 3, 5, 1, 1, 0, 0, 0, 0, 0 },
{ 7, 41, 37, 42, 48, 0, 0, 0, 0, 0 },
{ 8, 18, 12, 6, 6, 0, 0, 0, 0, 0 }
},
{
{ 54, 14, 13, 13, 14, 14, 13, 13, 14, 14 },
{ 9, 11, 13, 12, 12, 13, 10, 9, 9, 10 },
{ 10, 7, 6, 6, 9, 6, 7, 8, 9, 10 },
{ 4, 11, 11, 10, 9, 10, 11, 11, 8, 5 },
{ 4, 11, 10, 9, 7, 10, 10, 11, 12, 14 },
{ 4, 9, 7, 8, 7, 7, 7, 7, 8, 6 },
{ 4, 9, 7, 7, 7, 6, 7, 8, 10, 13 },
{ 5, 15, 22, 22, 22, 26, 24, 21, 18, 16 },
{ 7, 14, 12, 14, 15, 9, 10, 11, 11, 14 }
},
{
{ 66, 21, 14, 10, 9, 10, 9, 10, 10, 10 },
{ 11, 18, 19, 17, 17, 17, 15, 14, 13, 12 },
{ 11, 21, 16, 15, 14, 12, 12, 12, 12, 12 },
{ 2, 8, 10, 11, 11, 12, 12, 13, 12, 12 },
{ 2, 7, 9, 10, 11, 12, 13, 12, 13, 17 },
{ 3, 8, 10, 11, 11, 11, 11, 12, 12, 11 },
{ 2, 8, 9, 10, 11, 10, 11, 11, 12, 17 },
{ 1, 4, 6, 7, 8, 9, 9, 8, 7, 4 },
{ 1, 6, 7, 8, 9, 8, 8, 9, 8, 5 }
},
{
{ 88, 66, 59, 54, 50, 48, 46, 45, 47, 51 },
{ 6, 16, 18, 25, 21, 26, 26, 25, 23, 23 },
{ 6, 18, 23, 21, 29, 26, 28, 30, 30, 26 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
},
};
static const uint64_t allowed_part_weight_360p[5][9][10] = {
{
{ 80, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 8, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 5, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 2, 100, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 2, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 2, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
},
{
{ 59, 42, 2, 1, 2, 0, 0, 0, 0, 0 },
{ 7, 2, 15, 12, 11, 0, 0, 0, 0, 0 },
{ 10, 18, 6, 8, 6, 0, 0, 0, 0, 0 },
{ 2, 1, 5, 6, 2, 0, 0, 0, 0, 0 },
{ 3, 1, 3, 4, 5, 0, 0, 0, 0, 0 },
{ 2, 1, 4, 3, 4, 0, 0, 0, 0, 0 },
{ 2, 1, 3, 3, 5, 0, 0, 0, 0, 0 },
{ 6, 11, 53, 57, 58, 0, 0, 0, 0, 0 },
{ 10, 23, 9, 5, 8, 0, 0, 0, 0, 0 }
},
{
{ 54, 11, 9, 9, 12, 15, 12, 14, 18, 19 },
{ 8, 9, 10, 10, 11, 15, 13, 11, 10, 10 },
{ 8, 7, 6, 6, 8, 6, 6, 6, 7, 10 },
{ 4, 12, 12, 12, 11, 9, 10, 8, 9, 6 },
{ 4, 11, 12, 12, 10, 10, 10, 10, 9, 13 },
{ 5, 11, 9, 9, 8, 7, 6, 6, 8, 7 },
{ 5, 10, 10, 9, 9, 6, 6, 7, 8, 14 },
{ 5, 15, 18, 21, 20, 26, 30, 31, 23, 11 },
{ 7, 14, 14, 12, 12, 7, 6, 6, 7, 9 }
},
{
{ 61, 16, 12, 10, 10, 14, 13, 14, 14, 16 },
{ 11, 18, 18, 17, 17, 17, 16, 16, 15, 15 },
{ 13, 22, 18, 17, 16, 15, 15, 15, 15, 17 },
{ 3, 8, 10, 10, 10, 10, 11, 10, 11, 9 },
{ 3, 8, 9, 10, 10, 10, 10, 10, 11, 10 },
{ 3, 9, 10, 11, 11, 10, 10, 10, 11, 10 },
{ 3, 9, 10, 11, 11, 10, 10, 11, 11, 12 },
{ 1, 4, 5, 6, 7, 7, 8, 7, 6, 4 },
{ 2, 6, 7, 8, 8, 7, 7, 7, 6, 6 }
},
{
{ 91, 66, 59, 54, 51, 51, 50, 51, 51, 56 },
{ 5, 17, 19, 24, 21, 24, 24, 23, 22, 20 },
{ 4, 18, 23, 22, 28, 25, 26, 26, 27, 24 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
}
};
static const uint64_t allowed_part_weight_240pF[5][9][10] = {
{
{ 75, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 9, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 8, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 2, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 3, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 3, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
},
{
{ 61, 42, 3, 10, 5, 0, 0, 0, 0, 0},
{ 5, 2, 2, 2, 7, 0, 0, 0, 0, 0},
{ 10, 18, 5, 10, 5, 0, 0, 0, 0, 0},
{ 2, 1, 4, 2, 5, 0, 0, 0, 0, 0},
{ 3, 2, 5, 12, 7, 0, 0, 0, 0, 0},
{ 2, 1, 5, 5, 7, 0, 0, 0, 0, 0},
{ 2, 1, 4, 2, 7, 0, 0, 0, 0, 0},
{ 5, 9, 57, 48, 49, 0, 0, 0, 0, 0},
{ 11, 24, 16, 10, 9, 0, 0, 0, 0, 0}
},
{
{ 60, 12, 11, 9, 13, 21, 17, 14, 17, 20},
{ 7, 9, 10, 9, 9, 14, 13, 12, 10, 10},
{ 8, 8, 8, 8, 10, 7, 5, 5, 8, 8},
{ 3, 10, 10, 11, 11, 9, 11, 12, 9, 7},
{ 3, 10, 11, 12, 10, 10, 12, 11, 11, 12},
{ 4, 10, 9, 9, 7, 6, 5, 5, 6, 8},
{ 4, 10, 10, 11, 9, 6, 7, 6, 8, 10},
{ 4, 14, 17, 17, 14, 17, 23, 28, 23, 14},
{ 6, 17, 15, 15, 17, 9, 8, 7, 9, 10}
},
{
{ 65, 15, 10, 9, 10, 16, 14, 15, 14, 16},
{ 10, 17, 18, 17, 17, 18, 17, 17, 17, 16},
{ 12, 22, 19, 17, 16, 15, 15, 15, 14, 16},
{ 3, 8, 10, 10, 10, 9, 10, 10, 10, 8},
{ 2, 8, 10, 10, 10, 9, 10, 10, 11, 11},
{ 3, 10, 11, 12, 12, 10, 11, 10, 11, 10},
{ 3, 9, 11, 11, 12, 10, 11, 10, 11, 12},
{ 1, 3, 4, 5, 6, 6, 6, 6, 6, 5},
{ 1, 6, 7, 8, 8, 7, 7, 6, 6, 5}
},
{
{ 88, 63, 57, 51, 50, 50, 50, 52, 53, 60},
{ 6, 17, 18, 24, 21, 24, 22, 22, 20, 18},
{ 6, 20, 24, 25, 29, 26, 28, 27, 26, 22},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
}
};
#endif
#endif
#ifdef __cplusplus
}
#endif
#endif // EbCodingLoop_h
